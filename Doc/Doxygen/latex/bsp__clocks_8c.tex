\hypertarget{bsp__clocks_8c}{}\section{Kernel/\+Sources/arch/board/stm32/f401re/src/bsp\+\_\+clocks.c File Reference}
\label{bsp__clocks_8c}\index{Kernel/\+Sources/arch/board/stm32/f401re/src/bsp\+\_\+clocks.\+c@{Kernel/\+Sources/arch/board/stm32/f401re/src/bsp\+\_\+clocks.\+c}}
{\ttfamily \#include \char`\"{}error\+\_\+types.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}bsp\+\_\+clocks.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}bsp\+\_\+flash.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}bsp\+\_\+power.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}stdint.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}config.\+h\char`\"{}}\newline
Include dependency graph for bsp\+\_\+clocks.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsp__clocks_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{bsp__clocks_8c_a0ce28d57a364aa3702778c54bb4d3c05}{bsp\+\_\+clk\+\_\+base\+\_\+sys\+\_\+init} (void)
\begin{DoxyCompactList}\small\item\em Initializes system clocks. \end{DoxyCompactList}\item 
void \hyperlink{bsp__clocks_8c_a1b855e007d20366749d59e4eda97222f}{bsp\+\_\+clk\+\_\+pll\+\_\+init} (void)
\begin{DoxyCompactList}\small\item\em Initializes system P\+LL clocks. \end{DoxyCompactList}\item 
void \hyperlink{bsp__clocks_8c_a69dea9163b1220130c719ac0b3b9327f}{bsp\+\_\+clk\+\_\+switch\+\_\+to\+\_\+pll} (void)
\begin{DoxyCompactList}\small\item\em Sets the system clock to be driven by P\+LL output. \end{DoxyCompactList}\item 
static \hyperlink{stdint_8h_a324c5d28c0d82f502a234ab99efac87a}{uint32\+\_\+t} \hyperlink{bsp__clocks_8c_ac154ab5d2a56dd8e09e0545e9775112e}{bsp\+\_\+clock\+\_\+get\+\_\+pll\+\_\+freq} (void)
\begin{DoxyCompactList}\small\item\em Get the P\+LL output frequency in M\+Hz. \end{DoxyCompactList}\item 
\hyperlink{error__types_8h_acf146bc98f60f47c79d782f7523e339c}{E\+R\+R\+O\+R\+\_\+\+C\+O\+D\+E\+\_\+E} \hyperlink{bsp__clocks_8c_a500b2e77b70c93b3f2b4a94cc9bcf79d}{bsp\+\_\+clk\+\_\+gpio\+\_\+enable} (const \hyperlink{bsp__gpio_8h_ab086506332275a2a873dfce02ed5a3b8}{G\+P\+I\+O\+\_\+\+I\+D\+E\+N\+T\+I\+F\+I\+E\+R\+\_\+E} gpio\+\_\+id)
\begin{DoxyCompactList}\small\item\em Enables the G\+P\+IO clocks. \end{DoxyCompactList}\item 
\hyperlink{error__types_8h_acf146bc98f60f47c79d782f7523e339c}{E\+R\+R\+O\+R\+\_\+\+C\+O\+D\+E\+\_\+E} \hyperlink{bsp__clocks_8c_aaf01af602e17579af5e6af009ae7a557}{bsp\+\_\+clk\+\_\+usart\+\_\+enable} (const \hyperlink{bsp__usart_8h_a594f9d90a9a3875660da4512fb208cf9}{U\+S\+A\+R\+T\+\_\+\+I\+D\+E\+N\+T\+I\+F\+I\+E\+R\+\_\+E} usart\+\_\+id)
\begin{DoxyCompactList}\small\item\em Enables the U\+S\+A\+RT clocks. \end{DoxyCompactList}\item 
\hyperlink{error__types_8h_acf146bc98f60f47c79d782f7523e339c}{E\+R\+R\+O\+R\+\_\+\+C\+O\+D\+E\+\_\+E} \hyperlink{bsp__clocks_8c_a286d003315af35aa9dd72b86ba6d8420}{bsp\+\_\+clk\+\_\+sys\+\_\+init} (void)
\begin{DoxyCompactList}\small\item\em Initializes system clocks. \end{DoxyCompactList}\item 
\hyperlink{stdint_8h_a324c5d28c0d82f502a234ab99efac87a}{uint32\+\_\+t} \hyperlink{bsp__clocks_8c_aeeded4b587684fa3383b3d42ee29af1e}{bsp\+\_\+clocks\+\_\+get\+\_\+freq} (const \hyperlink{bsp__clocks_8h_ac9d4d589a659370f313ef156f6eff0e8}{C\+L\+O\+C\+K\+\_\+\+I\+D\+E\+N\+T\+I\+F\+I\+E\+R\+\_\+T} clk\+\_\+id)
\begin{DoxyCompactList}\small\item\em Get the frequencies in M\+Hz of the clocks which identifer corresponds to the identifier given as parameter. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{bsp__clocks_8c_a7e7b4728df96b76f3a8042b7fb46aa8c}{bsp\+\_\+clk\+\_\+init} = 0
\begin{DoxyCompactList}\small\item\em Stores the system clock init state. \end{DoxyCompactList}\item 
static const \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} \hyperlink{bsp__clocks_8c_abed7da9c2bfa6c8191c3bf928e64041f}{bsp\+\_\+hpre\+\_\+factor\+\_\+lookup} \mbox{[}8\mbox{]} = \{2, 4, 8, 16, 64, 128, 256, 512\}
\begin{DoxyCompactList}\small\item\em H\+R\+PE A\+HB prescaler factors lookup table. \end{DoxyCompactList}\item 
static const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} \hyperlink{bsp__clocks_8c_a1ef2cd1399c95dbe65a524595da1fc5c}{bsp\+\_\+ppre\+\_\+factor\+\_\+lookup} \mbox{[}4\mbox{]} = \{2, 4, 8, 16\}
\begin{DoxyCompactList}\small\item\em P\+P\+RE prescaler factors lookup table. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{bsp__clocks_8c_a0ce28d57a364aa3702778c54bb4d3c05}\label{bsp__clocks_8c_a0ce28d57a364aa3702778c54bb4d3c05}} 
\index{bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}!bsp\+\_\+clk\+\_\+base\+\_\+sys\+\_\+init@{bsp\+\_\+clk\+\_\+base\+\_\+sys\+\_\+init}}
\index{bsp\+\_\+clk\+\_\+base\+\_\+sys\+\_\+init@{bsp\+\_\+clk\+\_\+base\+\_\+sys\+\_\+init}!bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}}
\subsubsection{\texorpdfstring{bsp\+\_\+clk\+\_\+base\+\_\+sys\+\_\+init()}{bsp\_clk\_base\_sys\_init()}}
{\footnotesize\ttfamily void bsp\+\_\+clk\+\_\+base\+\_\+sys\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initializes system clocks. 

Initializes system clocks. The H\+SI is enabled and its calibration value. 

Definition at line 46 of file bsp\+\_\+clocks.\+c.


\begin{DoxyCode}
47 \{
48     *\hyperlink{bsp__clocks_8h_a2fcf7c04f16b1dd27c577a9a14c5ff96}{RCC\_CR\_REGISTER} = (*\hyperlink{bsp__clocks_8h_a2fcf7c04f16b1dd27c577a9a14c5ff96}{RCC\_CR\_REGISTER} & ~
      \hyperlink{bsp__clocks_8h_a73f9913edb8b30eb2b8aa1b5d29b297e}{RCC\_CR\_HSITRIM\_MASK}) | 
49                        (\hyperlink{bsp__clocks_8h_af4fcacf94a97f7d49a70e089b39cf474}{RCC\_CR\_HSION} | \hyperlink{bsp__clocks_8h_a12241a92893b4023a40e85d3b371ac05}{RCC\_CR\_HSITRIM\_DEF});
50     \textcolor{keywordflow}{while}((*\hyperlink{bsp__clocks_8h_a2fcf7c04f16b1dd27c577a9a14c5ff96}{RCC\_CR\_REGISTER} & \hyperlink{bsp__clocks_8h_a9dbac3f2bc04f04ebafe1e66ae3fcf0d}{RCC\_CR\_HSIRDY}) == 0);
51 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=337pt]{bsp__clocks_8c_a0ce28d57a364aa3702778c54bb4d3c05_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{bsp__clocks_8c_a500b2e77b70c93b3f2b4a94cc9bcf79d}\label{bsp__clocks_8c_a500b2e77b70c93b3f2b4a94cc9bcf79d}} 
\index{bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}!bsp\+\_\+clk\+\_\+gpio\+\_\+enable@{bsp\+\_\+clk\+\_\+gpio\+\_\+enable}}
\index{bsp\+\_\+clk\+\_\+gpio\+\_\+enable@{bsp\+\_\+clk\+\_\+gpio\+\_\+enable}!bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}}
\subsubsection{\texorpdfstring{bsp\+\_\+clk\+\_\+gpio\+\_\+enable()}{bsp\_clk\_gpio\_enable()}}
{\footnotesize\ttfamily \hyperlink{error__types_8h_acf146bc98f60f47c79d782f7523e339c}{E\+R\+R\+O\+R\+\_\+\+C\+O\+D\+E\+\_\+E} bsp\+\_\+clk\+\_\+gpio\+\_\+enable (\begin{DoxyParamCaption}\item[{const \hyperlink{bsp__gpio_8h_ab086506332275a2a873dfce02ed5a3b8}{G\+P\+I\+O\+\_\+\+I\+D\+E\+N\+T\+I\+F\+I\+E\+R\+\_\+E}}]{gpio\+\_\+id }\end{DoxyParamCaption})}



Enables the G\+P\+IO clocks. 

Enables the G\+P\+IO clocks. This function will enable the peripheral clock used by the G\+P\+IO corresponding to the identifier given as parameter. If the identifier is unknown, the function has no effect.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em gpio\+\_\+id} & The G\+P\+IO identifier for which the clock should be enabled.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
N\+O\+\_\+\+E\+R\+R\+OR is returned in case of success. Otherwise an error code is returned. Please refer to the list of the standard error codes. 
\end{DoxyReturn}


Definition at line 145 of file bsp\+\_\+clocks.\+c.


\begin{DoxyCode}
146 \{
147     \hyperlink{stdint_8h_a324c5d28c0d82f502a234ab99efac87a}{uint32\_t} reg\_val;
148 
149     \textcolor{keywordflow}{switch}(gpio\_id)
150     \{
151         \textcolor{keywordflow}{case} \hyperlink{bsp__gpio_8h_a69f521b579d2c761dd65949f2bae88f3a4cb73b98ec508807d984052a1598950a}{GPIO\_ID\_A}:
152             reg\_val = \hyperlink{bsp__clocks_8h_a6ff46fb3b30fc6792e4fd18fcb0941b5}{RCC\_AHB1ENR\_GPIOAEN};
153             \textcolor{keywordflow}{break};
154         \textcolor{keywordflow}{case} \hyperlink{bsp__gpio_8h_a69f521b579d2c761dd65949f2bae88f3a9fc59b324d277c00de32d87f8072b56a}{GPIO\_ID\_B}:
155             reg\_val = \hyperlink{bsp__clocks_8h_ad7f408f92e7fd49b0957b8cb4ff31ca5}{RCC\_AHB1ENR\_GPIOBEN};
156             \textcolor{keywordflow}{break};
157         \textcolor{keywordflow}{case} \hyperlink{bsp__gpio_8h_a69f521b579d2c761dd65949f2bae88f3afae76fa0a334173cbea6472ae010d0a9}{GPIO\_ID\_C}:
158             reg\_val = \hyperlink{bsp__clocks_8h_ae8a8b42e33aef2a7bc2d41ad9d231733}{RCC\_AHB1ENR\_GPIOCEN};
159             \textcolor{keywordflow}{break};
160         \textcolor{keywordflow}{case} \hyperlink{bsp__gpio_8h_a69f521b579d2c761dd65949f2bae88f3ad6df84175b0fc74ef3c655082b648918}{GPIO\_ID\_D}:
161             reg\_val = \hyperlink{bsp__clocks_8h_aebd8146e91c76f14af8dfe78a1c2d916}{RCC\_AHB1ENR\_GPIODEN};
162             \textcolor{keywordflow}{break};
163         \textcolor{keywordflow}{case} \hyperlink{bsp__gpio_8h_a69f521b579d2c761dd65949f2bae88f3a496fabc0d5663f4956df5e9a4d275ed4}{GPIO\_ID\_E}:
164             reg\_val = \hyperlink{bsp__clocks_8h_a67a9094e0e464eaa8e25f854f90abfc6}{RCC\_AHB1ENR\_GPIOEEN};
165             \textcolor{keywordflow}{break};
166         \textcolor{keywordflow}{case} \hyperlink{bsp__gpio_8h_a69f521b579d2c761dd65949f2bae88f3aa25ae326f6c8e013c190052d0a3c7d29}{GPIO\_ID\_H}:
167             reg\_val = \hyperlink{bsp__clocks_8h_adb16afc550121895822ebb22108196b6}{RCC\_AHB1ENR\_GPIOHEN};
168             \textcolor{keywordflow}{break};
169         \textcolor{keywordflow}{default}:
170             reg\_val = 0;
171     \}
172 
173     \textcolor{keywordflow}{if}(reg\_val == 0)
174     \{
175 \textcolor{preprocessor}{#if KERNEL\_LOG\_LEVEL == ERROR\_LOG\_LEVEL}
176         \hyperlink{logger_8h_a580bb63c1418b2fc8456f9b6c5b6d39d}{KERNEL\_LOG\_ERROR}(\textcolor{stringliteral}{"Wrong GPIO identifer"}, 
177                          gpio\_id, 
178                          \textcolor{keyword}{sizeof}(gpio\_id), 
179                          \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabbe6797281350f36c23d07d6f2d7f6e2}{ERROR\_INVALID\_PARAM});
180 \textcolor{preprocessor}{#endif}
181         \textcolor{keywordflow}{return} \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabbe6797281350f36c23d07d6f2d7f6e2}{ERROR\_INVALID\_PARAM};
182     \}
183 
184     *\hyperlink{bsp__clocks_8h_a4c6aae1c96c5acee8a320c6b2a8aaee5}{RCC\_AHB1ENR\_REGISTER} = *\hyperlink{bsp__clocks_8h_a4c6aae1c96c5acee8a320c6b2a8aaee5}{RCC\_AHB1ENR\_REGISTER} | reg\_val;
185     \textcolor{keywordflow}{while}((*\hyperlink{bsp__clocks_8h_a4c6aae1c96c5acee8a320c6b2a8aaee5}{RCC\_AHB1ENR\_REGISTER} & reg\_val) == 0);
186 
187 \textcolor{preprocessor}{#if KERNEL\_LOG\_LEVEL >= INFO\_LOG\_LEVEL}
188         KERNEL\_LOG\_INFO(\textcolor{stringliteral}{"GPIO clock enabled"}, 
189                         gpio\_id, 
190                         \textcolor{keyword}{sizeof}(gpio\_id), 
191                         \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR});
192 \textcolor{preprocessor}{#endif}
193 
194     \textcolor{keywordflow}{return} \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
195 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsp__clocks_8c_a500b2e77b70c93b3f2b4a94cc9bcf79d_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsp__clocks_8c_a500b2e77b70c93b3f2b4a94cc9bcf79d_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{bsp__clocks_8c_a1b855e007d20366749d59e4eda97222f}\label{bsp__clocks_8c_a1b855e007d20366749d59e4eda97222f}} 
\index{bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}!bsp\+\_\+clk\+\_\+pll\+\_\+init@{bsp\+\_\+clk\+\_\+pll\+\_\+init}}
\index{bsp\+\_\+clk\+\_\+pll\+\_\+init@{bsp\+\_\+clk\+\_\+pll\+\_\+init}!bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}}
\subsubsection{\texorpdfstring{bsp\+\_\+clk\+\_\+pll\+\_\+init()}{bsp\_clk\_pll\_init()}}
{\footnotesize\ttfamily void bsp\+\_\+clk\+\_\+pll\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initializes system P\+LL clocks. 

Initializes system P\+LL clocks. The P\+LL are set for a system clock of 84\+M\+Hz and bus to 48\+M\+Hz. 

Definition at line 59 of file bsp\+\_\+clocks.\+c.


\begin{DoxyCode}
60 \{
61     \textcolor{comment}{/* PLL should be disabled at that point */}
62     *\hyperlink{bsp__clocks_8h_ad2d60b66a5292f1c04c7c3ebfe9df335}{RCC\_PLLCFGR\_REGISTER} = *\hyperlink{bsp__clocks_8h_ad2d60b66a5292f1c04c7c3ebfe9df335}{RCC\_PLLCFGR\_REGISTER} & 
63                             ~(\hyperlink{bsp__clocks_8h_afaac3bc429eaa475ca5e431a020d4c67}{RCC\_PLLCFGR\_PLLM\_MASK} | 
      \hyperlink{bsp__clocks_8h_a90997335764397eb4be02c23676cda4a}{RCC\_PLLCFGR\_PLLN\_MASK} | 
64                               \hyperlink{bsp__clocks_8h_a40a7c5938dfdd0ab63dcf3b203da7dd4}{RCC\_PLLCFGR\_PLLP\_MASK} | 
      \hyperlink{bsp__clocks_8h_ad4784939ce13e81f2cc64dda2b5d8770}{RCC\_PLLCFGR\_PLLQ\_MASK} | 
65                               \hyperlink{bsp__clocks_8h_a6c5c6a2e8d760ad7da85ae2c8076ee31}{RCC\_PLLCFGR\_PLLSRC\_MASK});
66 
67     \textcolor{comment}{/* Set the PLL values */}
68     *\hyperlink{bsp__clocks_8h_ad2d60b66a5292f1c04c7c3ebfe9df335}{RCC\_PLLCFGR\_REGISTER} = *\hyperlink{bsp__clocks_8h_ad2d60b66a5292f1c04c7c3ebfe9df335}{RCC\_PLLCFGR\_REGISTER} |
69                             (\hyperlink{bsp__clocks_8h_adc4eb2ce50286dc96d4976b9689be1d7}{RCC\_PLLM\_VALUE} << 
      \hyperlink{bsp__clocks_8h_add5fc49687031bdd44fca9c909f74fe0}{RCC\_PLLCFGR\_PLLM\_OFFSET}) |
70                             (\hyperlink{bsp__clocks_8h_a11fa93ae89931a632e06eb0694ff62b7}{RCC\_PLLN\_VALUE} << 
      \hyperlink{bsp__clocks_8h_adc0f70732fb3d933c96d741f27baec35}{RCC\_PLLCFGR\_PLLN\_OFFSET}) |
71                             (\hyperlink{bsp__clocks_8h_a9ad812030f6e208e79df8e9bddb96c19}{RCC\_PLLP\_VALUE} << 
      \hyperlink{bsp__clocks_8h_a9a6c6234e6c59e7638d1a8edd237f591}{RCC\_PLLCFGR\_PLLP\_OFFSET}) |
72                             (\hyperlink{bsp__clocks_8h_a0babc931753727d1ee6b56d41a51f598}{RCC\_PLLQ\_VALUE} << 
      \hyperlink{bsp__clocks_8h_aa47b1576488cea5e741f58cce74337c9}{RCC\_PLLCFGR\_PLLQ\_OFFSET}) |
73                             (\hyperlink{bsp__clocks_8h_ae90c3d400891ac3355363979581bd924}{RCC\_PLLSRC\_VALUE} << 
      \hyperlink{bsp__clocks_8h_a001728588571f89b2b52e6a903e66395}{RCC\_PLLCFGR\_PLLSRC\_OFFSET});
74 
75     \textcolor{comment}{/* Enable PLLs */}
76     *\hyperlink{bsp__clocks_8h_a2fcf7c04f16b1dd27c577a9a14c5ff96}{RCC\_CR\_REGISTER} = *\hyperlink{bsp__clocks_8h_a2fcf7c04f16b1dd27c577a9a14c5ff96}{RCC\_CR\_REGISTER} | 
      \hyperlink{bsp__clocks_8h_ad0e73d5b0a4883e074d40029b49ee47e}{RCC\_CR\_PLLON};
77     
78     \textcolor{comment}{/* Wait for PLL lock */}
79     \textcolor{keywordflow}{while}((*\hyperlink{bsp__clocks_8h_a2fcf7c04f16b1dd27c577a9a14c5ff96}{RCC\_CR\_REGISTER} & \hyperlink{bsp__clocks_8h_afa12d7ac6a7f0f91d066aeb2c6071888}{RCC\_CR\_PLLRDY}) == 0);
80 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=304pt]{bsp__clocks_8c_a1b855e007d20366749d59e4eda97222f_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{bsp__clocks_8c_a69dea9163b1220130c719ac0b3b9327f}\label{bsp__clocks_8c_a69dea9163b1220130c719ac0b3b9327f}} 
\index{bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}!bsp\+\_\+clk\+\_\+switch\+\_\+to\+\_\+pll@{bsp\+\_\+clk\+\_\+switch\+\_\+to\+\_\+pll}}
\index{bsp\+\_\+clk\+\_\+switch\+\_\+to\+\_\+pll@{bsp\+\_\+clk\+\_\+switch\+\_\+to\+\_\+pll}!bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}}
\subsubsection{\texorpdfstring{bsp\+\_\+clk\+\_\+switch\+\_\+to\+\_\+pll()}{bsp\_clk\_switch\_to\_pll()}}
{\footnotesize\ttfamily void bsp\+\_\+clk\+\_\+switch\+\_\+to\+\_\+pll (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Sets the system clock to be driven by P\+LL output. 

Sets the system clock to be driven by P\+LL output. 

Definition at line 87 of file bsp\+\_\+clocks.\+c.


\begin{DoxyCode}
88 \{
89     \textcolor{comment}{/* Set AHB, APB1 and APB2 prescaler values */}
90     *\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} = *\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} & 
91                         ~(\hyperlink{bsp__clocks_8h_a7b024c33f9bd185d923b55af2360fec5}{RCC\_CFGR\_HRPE\_MASK}  |
92                           \hyperlink{bsp__clocks_8h_a1220a63e00de9ff4a2a45474ead3662d}{RCC\_CFGR\_PPRE1\_MASK} |
93                           \hyperlink{bsp__clocks_8h_a41aef118b0611444caa87df8ea302dc2}{RCC\_CFGR\_PPRE2\_MASK});
94     *\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} = *\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER}   | 
      \hyperlink{bsp__clocks_8h_a3fe59bf63a37a12304f37d7babec3eeb}{RCC\_CFGR\_HRPE\_DIV1} | 
95                           \hyperlink{bsp__clocks_8h_af832ad6844c907d9bb37c1536defcb0d}{RCC\_CFGR\_PPRE1\_DIV2} | 
      \hyperlink{bsp__clocks_8h_a247aebf1999a38ea07785558d277bb1a}{RCC\_CFGR\_PPRE2\_DIV1};
96 
97     \textcolor{comment}{/* Set the system clock to use PLL as input */}
98     *\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} = (*\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} & ~
      \hyperlink{bsp__clocks_8h_a7e5e28699fe923870e15fef3651ff3ef}{RCC\_CFGR\_SW\_MASK}) | 
99                         \hyperlink{bsp__clocks_8h_a87389cacb2eaf53730da13a2a33cd487}{RCC\_CFGR\_SW\_PLL};
100     
101     \textcolor{comment}{/* Wait for update */}
102     \textcolor{keywordflow}{while}((*\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} & \hyperlink{bsp__clocks_8h_a451045d952eb1caaa0090c9e8dc75082}{RCC\_CFGR\_SWS\_MASK}) != 
      \hyperlink{bsp__clocks_8h_a2c67e2279804a83ef24438267d9d4a6c}{RCC\_CFGR\_SWS\_PLL});
103 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=334pt]{bsp__clocks_8c_a69dea9163b1220130c719ac0b3b9327f_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{bsp__clocks_8c_a286d003315af35aa9dd72b86ba6d8420}\label{bsp__clocks_8c_a286d003315af35aa9dd72b86ba6d8420}} 
\index{bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}!bsp\+\_\+clk\+\_\+sys\+\_\+init@{bsp\+\_\+clk\+\_\+sys\+\_\+init}}
\index{bsp\+\_\+clk\+\_\+sys\+\_\+init@{bsp\+\_\+clk\+\_\+sys\+\_\+init}!bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}}
\subsubsection{\texorpdfstring{bsp\+\_\+clk\+\_\+sys\+\_\+init()}{bsp\_clk\_sys\_init()}}
{\footnotesize\ttfamily \hyperlink{error__types_8h_acf146bc98f60f47c79d782f7523e339c}{E\+R\+R\+O\+R\+\_\+\+C\+O\+D\+E\+\_\+E} bsp\+\_\+clk\+\_\+sys\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initializes system clocks. 

Initializes system clocks. The C\+PU, A\+HB and A\+PB clocks are initialized. The function also sets the regulator output voltage needed by the clocks.

\begin{DoxyReturn}{Returns}
N\+O\+\_\+\+E\+R\+R\+OR is returned in case of success. Otherwise an error code is returned. Please refer to the list of the standard error codes. 
\end{DoxyReturn}


Definition at line 242 of file bsp\+\_\+clocks.\+c.


\begin{DoxyCode}
243 \{
244     \hyperlink{error__types_8h_acf146bc98f60f47c79d782f7523e339c}{ERROR\_CODE\_E} error;
245 
246     \textcolor{comment}{/* Check init state */}
247     \textcolor{keywordflow}{if}(\hyperlink{bsp__clocks_8c_a7e7b4728df96b76f3a8042b7fb46aa8c}{bsp\_clk\_init} != 0)
248     \{
249 \textcolor{preprocessor}{#if KERNEL\_LOG\_LEVEL == ERROR\_LOG\_LEVEL}
250         \hyperlink{logger_8h_a580bb63c1418b2fc8456f9b6c5b6d39d}{KERNEL\_LOG\_ERROR}(\textcolor{stringliteral}{"System clock is already initialized"}, 
251                          \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28ca9af911a6ba1c32ce22213d689cb59f86}{ERROR\_ALREADY\_INIT}, 
252                          \textcolor{keyword}{sizeof}(\hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28ca9af911a6ba1c32ce22213d689cb59f86}{ERROR\_ALREADY\_INIT}), 
253                          \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28ca9af911a6ba1c32ce22213d689cb59f86}{ERROR\_ALREADY\_INIT});
254 \textcolor{preprocessor}{#endif}
255         \textcolor{keywordflow}{return} \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28ca9af911a6ba1c32ce22213d689cb59f86}{ERROR\_ALREADY\_INIT};
256     \}
257 
258     \textcolor{comment}{/* Enable the power interface clock and system clock controller */}
259     *\hyperlink{bsp__clocks_8h_aae3fa9b2133a67e3ca65db35f8ac9a4c}{RCC\_APB1ENR\_REGISTER} = *\hyperlink{bsp__clocks_8h_aae3fa9b2133a67e3ca65db35f8ac9a4c}{RCC\_APB1ENR\_REGISTER} | 
      \hyperlink{bsp__clocks_8h_a5c19997ccd28464b80a7c3325da0ca60}{RCC\_APB1ENR\_PWREN};
260     \textcolor{keywordflow}{while}((*\hyperlink{bsp__clocks_8h_aae3fa9b2133a67e3ca65db35f8ac9a4c}{RCC\_APB1ENR\_REGISTER} & \hyperlink{bsp__clocks_8h_a5c19997ccd28464b80a7c3325da0ca60}{RCC\_APB1ENR\_PWREN}) == 0);
261     *\hyperlink{bsp__clocks_8h_aae721f66e88c2e4264580d95d5ffdd59}{RCC\_APB2ENR\_REGISTER} = *\hyperlink{bsp__clocks_8h_aae721f66e88c2e4264580d95d5ffdd59}{RCC\_APB2ENR\_REGISTER} | 
      \hyperlink{bsp__clocks_8h_a7a9d56a8aa1fa0f519ecbdf0d19dd4da}{RCC\_APB2ENR\_SYSCFGEN};
262     \textcolor{keywordflow}{while}((*\hyperlink{bsp__clocks_8h_aae721f66e88c2e4264580d95d5ffdd59}{RCC\_APB2ENR\_REGISTER} & \hyperlink{bsp__clocks_8h_a7a9d56a8aa1fa0f519ecbdf0d19dd4da}{RCC\_APB2ENR\_SYSCFGEN}) == 0);
263 
264     \textcolor{comment}{/* Update voltage scaling */}
265     error = \hyperlink{bsp__power_8h_abe4bd68d683c1ab3fbc83afb60b36ede}{bsp\_pwr\_set\_scaling}(\hyperlink{bsp__power_8h_aeab31582495468040935b45b76f06553a8ddc2bb242e2a77509aad0d808c22339}{POWER\_SCALING\_MODE\_2});
266     \textcolor{keywordflow}{if}(error != \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
267     \{
268         \textcolor{keywordflow}{return} error;
269     \}
270     
271     \textcolor{comment}{/* Set flash latency */}
272     error = \hyperlink{bsp__flash_8h_a51f3c79743adab8e26ca7a5c6b33c55b}{bsp\_flash\_set\_latency}(\hyperlink{bsp__flash_8h_ad230debff3c818a6f9ced62364bc86c0ad84e36d61f83d1f0104cb3384726476c}{FLASH\_LATENCY\_WS\_2});
273     \textcolor{keywordflow}{if}(error != \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
274     \{
275         \textcolor{keywordflow}{return} error;
276     \}
277 
278     \textcolor{comment}{/* Init systems clocks */}
279     \hyperlink{bsp__clocks_8c_a0ce28d57a364aa3702778c54bb4d3c05}{bsp\_clk\_base\_sys\_init}();
280     \hyperlink{bsp__clocks_8c_a1b855e007d20366749d59e4eda97222f}{bsp\_clk\_pll\_init}();
281     \hyperlink{bsp__clocks_8c_a69dea9163b1220130c719ac0b3b9327f}{bsp\_clk\_switch\_to\_pll}();
282 
283     \textcolor{comment}{/* Init GPIO and USART clocks */}
284     error = \hyperlink{bsp__clocks_8c_a500b2e77b70c93b3f2b4a94cc9bcf79d}{bsp\_clk\_gpio\_enable}(\hyperlink{bsp__gpio_8h_a69f521b579d2c761dd65949f2bae88f3a4cb73b98ec508807d984052a1598950a}{GPIO\_ID\_A});
285     \textcolor{keywordflow}{if}(error != \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
286     \{
287         \textcolor{keywordflow}{return} error;
288     \}
289     error = \hyperlink{bsp__clocks_8c_aaf01af602e17579af5e6af009ae7a557}{bsp\_clk\_usart\_enable}(\hyperlink{bsp__usart_8h_a58f9be3820e29e0fbf00e2466c3ee768abb138542d801249fd01ec62c34f52cff}{USART\_ID\_2});
290     \textcolor{keywordflow}{if}(error != \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR})
291     \{
292         \textcolor{keywordflow}{return} error;
293     \}
294 
295 \textcolor{preprocessor}{#if KERNEL\_LOG\_LEVEL >= INFO\_LOG\_LEVEL}
296     KERNEL\_LOG\_INFO(\textcolor{stringliteral}{"System clock initialized"}, 
297                     \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR}, 
298                     \textcolor{keyword}{sizeof}(\hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR}), 
299                     \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR});
300 \textcolor{preprocessor}{#endif}
301 
302     \textcolor{comment}{/* Update init state */}
303     \hyperlink{bsp__clocks_8c_a7e7b4728df96b76f3a8042b7fb46aa8c}{bsp\_clk\_init} = 1;
304     \textcolor{keywordflow}{return} \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
305 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsp__clocks_8c_a286d003315af35aa9dd72b86ba6d8420_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{bsp__clocks_8c_aaf01af602e17579af5e6af009ae7a557}\label{bsp__clocks_8c_aaf01af602e17579af5e6af009ae7a557}} 
\index{bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}!bsp\+\_\+clk\+\_\+usart\+\_\+enable@{bsp\+\_\+clk\+\_\+usart\+\_\+enable}}
\index{bsp\+\_\+clk\+\_\+usart\+\_\+enable@{bsp\+\_\+clk\+\_\+usart\+\_\+enable}!bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}}
\subsubsection{\texorpdfstring{bsp\+\_\+clk\+\_\+usart\+\_\+enable()}{bsp\_clk\_usart\_enable()}}
{\footnotesize\ttfamily \hyperlink{error__types_8h_acf146bc98f60f47c79d782f7523e339c}{E\+R\+R\+O\+R\+\_\+\+C\+O\+D\+E\+\_\+E} bsp\+\_\+clk\+\_\+usart\+\_\+enable (\begin{DoxyParamCaption}\item[{const \hyperlink{bsp__usart_8h_a594f9d90a9a3875660da4512fb208cf9}{U\+S\+A\+R\+T\+\_\+\+I\+D\+E\+N\+T\+I\+F\+I\+E\+R\+\_\+E}}]{usart\+\_\+id }\end{DoxyParamCaption})}



Enables the U\+S\+A\+RT clocks. 

Enables the U\+S\+A\+RT clocks. This function will enable the peripheral clock used by the U\+S\+A\+RT corresponding to the identifier given as parameter. If the identifier is unknown, the function has no effect.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em usart\+\_\+id} & The U\+S\+A\+RT identifier for which the clock should be enabled.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
N\+O\+\_\+\+E\+R\+R\+OR is returned in case of success. Otherwise an error code is returned. Please refer to the list of the standard error codes. 
\end{DoxyReturn}


Definition at line 197 of file bsp\+\_\+clocks.\+c.


\begin{DoxyCode}
198 \{
199     \hyperlink{error__types_8h_acf146bc98f60f47c79d782f7523e339c}{ERROR\_CODE\_E} error;
200 
201     error = \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR};
202 
203     \textcolor{comment}{/* Select the USART interface */}
204     \textcolor{keywordflow}{switch}(usart\_id)
205     \{
206         \textcolor{keywordflow}{case} \hyperlink{bsp__usart_8h_a58f9be3820e29e0fbf00e2466c3ee768a512d550c862eac9ad45d923508bb0f7d}{USART\_ID\_1}:
207             *\hyperlink{bsp__clocks_8h_aae721f66e88c2e4264580d95d5ffdd59}{RCC\_APB2ENR\_REGISTER} = *\hyperlink{bsp__clocks_8h_aae721f66e88c2e4264580d95d5ffdd59}{RCC\_APB2ENR\_REGISTER} | 
208                                      \hyperlink{bsp__clocks_8h_a4666bb90842e8134b32e6a34a0f165f3}{RCC\_APB2ENR\_USART1EN};
209             \textcolor{keywordflow}{while}((*\hyperlink{bsp__clocks_8h_aae721f66e88c2e4264580d95d5ffdd59}{RCC\_APB2ENR\_REGISTER} & 
      \hyperlink{bsp__clocks_8h_a4666bb90842e8134b32e6a34a0f165f3}{RCC\_APB2ENR\_USART1EN}) == 0);
210             \textcolor{keywordflow}{break};
211         \textcolor{keywordflow}{case} \hyperlink{bsp__usart_8h_a58f9be3820e29e0fbf00e2466c3ee768abb138542d801249fd01ec62c34f52cff}{USART\_ID\_2}:
212             *\hyperlink{bsp__clocks_8h_aae3fa9b2133a67e3ca65db35f8ac9a4c}{RCC\_APB1ENR\_REGISTER} = *\hyperlink{bsp__clocks_8h_aae3fa9b2133a67e3ca65db35f8ac9a4c}{RCC\_APB1ENR\_REGISTER} | 
213                                      \hyperlink{bsp__clocks_8h_ab840af4f735ec36419d61c7db3cfa00d}{RCC\_APB1ENR\_USART2EN};
214             \textcolor{keywordflow}{while}((*\hyperlink{bsp__clocks_8h_aae3fa9b2133a67e3ca65db35f8ac9a4c}{RCC\_APB1ENR\_REGISTER} & 
      \hyperlink{bsp__clocks_8h_ab840af4f735ec36419d61c7db3cfa00d}{RCC\_APB1ENR\_USART2EN}) == 0);
215             \textcolor{keywordflow}{break};
216         \textcolor{keywordflow}{case} \hyperlink{bsp__usart_8h_a58f9be3820e29e0fbf00e2466c3ee768afd45e5de3678cbcada70f46bde327479}{USART\_ID\_6}:
217             *\hyperlink{bsp__clocks_8h_aae721f66e88c2e4264580d95d5ffdd59}{RCC\_APB2ENR\_REGISTER} = *\hyperlink{bsp__clocks_8h_aae721f66e88c2e4264580d95d5ffdd59}{RCC\_APB2ENR\_REGISTER} | 
218                                      \hyperlink{bsp__clocks_8h_a0569d91f3b18ae130b7a09e0100c4459}{RCC\_APB2ENR\_USART6EN};
219             \textcolor{keywordflow}{while}((*\hyperlink{bsp__clocks_8h_aae721f66e88c2e4264580d95d5ffdd59}{RCC\_APB2ENR\_REGISTER} & 
      \hyperlink{bsp__clocks_8h_a0569d91f3b18ae130b7a09e0100c4459}{RCC\_APB2ENR\_USART6EN}) == 0);
220             \textcolor{keywordflow}{break};
221 
222         \textcolor{keywordflow}{default}:
223 \textcolor{preprocessor}{#if KERNEL\_LOG\_LEVEL == ERROR\_LOG\_LEVEL}
224             \hyperlink{logger_8h_a580bb63c1418b2fc8456f9b6c5b6d39d}{KERNEL\_LOG\_ERROR}(\textcolor{stringliteral}{"Wrong USART identifer"}, 
225                             usart\_id, 
226                             \textcolor{keyword}{sizeof}(usart\_id), 
227                             \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabbe6797281350f36c23d07d6f2d7f6e2}{ERROR\_INVALID\_PARAM});
228 \textcolor{preprocessor}{#endif}
229             error = \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabbe6797281350f36c23d07d6f2d7f6e2}{ERROR\_INVALID\_PARAM};
230     \}
231 
232 \textcolor{preprocessor}{#if KERNEL\_LOG\_LEVEL >= INFO\_LOG\_LEVEL}
233     KERNEL\_LOG\_INFO(\textcolor{stringliteral}{"USART clock enabled"}, 
234                     usart\_id, 
235                     \textcolor{keyword}{sizeof}(usart\_id), 
236                     \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR});
237 \textcolor{preprocessor}{#endif}
238 
239     \textcolor{keywordflow}{return} error;
240 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsp__clocks_8c_aaf01af602e17579af5e6af009ae7a557_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsp__clocks_8c_aaf01af602e17579af5e6af009ae7a557_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{bsp__clocks_8c_ac154ab5d2a56dd8e09e0545e9775112e}\label{bsp__clocks_8c_ac154ab5d2a56dd8e09e0545e9775112e}} 
\index{bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}!bsp\+\_\+clock\+\_\+get\+\_\+pll\+\_\+freq@{bsp\+\_\+clock\+\_\+get\+\_\+pll\+\_\+freq}}
\index{bsp\+\_\+clock\+\_\+get\+\_\+pll\+\_\+freq@{bsp\+\_\+clock\+\_\+get\+\_\+pll\+\_\+freq}!bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}}
\subsubsection{\texorpdfstring{bsp\+\_\+clock\+\_\+get\+\_\+pll\+\_\+freq()}{bsp\_clock\_get\_pll\_freq()}}
{\footnotesize\ttfamily static \hyperlink{stdint_8h_a324c5d28c0d82f502a234ab99efac87a}{uint32\+\_\+t} bsp\+\_\+clock\+\_\+get\+\_\+pll\+\_\+freq (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Get the P\+LL output frequency in M\+Hz. 

Reads the P\+LL registers and compute the current P\+LL output frequency. The frequency returned is expressed in M\+Hz.

\begin{DoxyReturn}{Returns}
The P\+LL output frequency in M\+Hz. 
\end{DoxyReturn}


Definition at line 113 of file bsp\+\_\+clocks.\+c.


\begin{DoxyCode}
114 \{
115     \hyperlink{stdint_8h_a324c5d28c0d82f502a234ab99efac87a}{uint32\_t} pll\_freq;
116 
117     \textcolor{comment}{/* Get Source clock */}
118     \textcolor{keywordflow}{if}((*\hyperlink{bsp__clocks_8h_ad2d60b66a5292f1c04c7c3ebfe9df335}{RCC\_PLLCFGR\_REGISTER} & \hyperlink{bsp__clocks_8h_a6c5c6a2e8d760ad7da85ae2c8076ee31}{RCC\_PLLCFGR\_PLLSRC\_MASK}) == 0)
119     \{
120         pll\_freq = \hyperlink{bsp__clocks_8h_ae89e6b2d1e86b7fb4831cb013ece2c52}{RCC\_HSI\_BASE\_FREQ};
121     \}
122     \textcolor{keywordflow}{else} 
123     \{
124         pll\_freq = \hyperlink{bsp__clocks_8h_a19d723f47200a1da259e9c147f2de258}{RCC\_HSE\_BASE\_FREQ};
125     \}
126 
127     \textcolor{comment}{/* Get PLLM value */}
128     pll\_freq /= (*\hyperlink{bsp__clocks_8h_ad2d60b66a5292f1c04c7c3ebfe9df335}{RCC\_PLLCFGR\_REGISTER} & 
      \hyperlink{bsp__clocks_8h_afaac3bc429eaa475ca5e431a020d4c67}{RCC\_PLLCFGR\_PLLM\_MASK}) >> 
129                  \hyperlink{bsp__clocks_8h_add5fc49687031bdd44fca9c909f74fe0}{RCC\_PLLCFGR\_PLLM\_OFFSET};
130     \textcolor{comment}{/* Get PLLN value */}
131     pll\_freq *= (*\hyperlink{bsp__clocks_8h_ad2d60b66a5292f1c04c7c3ebfe9df335}{RCC\_PLLCFGR\_REGISTER} & 
      \hyperlink{bsp__clocks_8h_a90997335764397eb4be02c23676cda4a}{RCC\_PLLCFGR\_PLLN\_MASK}) >> 
132                  \hyperlink{bsp__clocks_8h_adc0f70732fb3d933c96d741f27baec35}{RCC\_PLLCFGR\_PLLN\_OFFSET};
133     \textcolor{comment}{/* Get PLLP value */}
134     pll\_freq /= (((*\hyperlink{bsp__clocks_8h_ad2d60b66a5292f1c04c7c3ebfe9df335}{RCC\_PLLCFGR\_REGISTER} & 
      \hyperlink{bsp__clocks_8h_a40a7c5938dfdd0ab63dcf3b203da7dd4}{RCC\_PLLCFGR\_PLLP\_MASK}) >> 
135                  \hyperlink{bsp__clocks_8h_a9a6c6234e6c59e7638d1a8edd237f591}{RCC\_PLLCFGR\_PLLP\_OFFSET}) + 1) * 2;
136     
137     \textcolor{keywordflow}{return} pll\_freq;
138 \}
\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsp__clocks_8c_ac154ab5d2a56dd8e09e0545e9775112e_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{bsp__clocks_8c_aeeded4b587684fa3383b3d42ee29af1e}\label{bsp__clocks_8c_aeeded4b587684fa3383b3d42ee29af1e}} 
\index{bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}!bsp\+\_\+clocks\+\_\+get\+\_\+freq@{bsp\+\_\+clocks\+\_\+get\+\_\+freq}}
\index{bsp\+\_\+clocks\+\_\+get\+\_\+freq@{bsp\+\_\+clocks\+\_\+get\+\_\+freq}!bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}}
\subsubsection{\texorpdfstring{bsp\+\_\+clocks\+\_\+get\+\_\+freq()}{bsp\_clocks\_get\_freq()}}
{\footnotesize\ttfamily \hyperlink{stdint_8h_a324c5d28c0d82f502a234ab99efac87a}{uint32\+\_\+t} bsp\+\_\+clocks\+\_\+get\+\_\+freq (\begin{DoxyParamCaption}\item[{const \hyperlink{bsp__clocks_8h_ac9d4d589a659370f313ef156f6eff0e8}{C\+L\+O\+C\+K\+\_\+\+I\+D\+E\+N\+T\+I\+F\+I\+E\+R\+\_\+T}}]{clk\+\_\+id }\end{DoxyParamCaption})}



Get the frequencies in M\+Hz of the clocks which identifer corresponds to the identifier given as parameter. 

Get the frequencies of the clocks which identifer corresponds to the identifier given as parameter. The P\+LL parameters and other clocks register are read to return the correct frequency for a given clock.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em clk\+\_\+id} & The identifier of the clock.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The frequency in M\+Hz of the clock is returned. 
\end{DoxyReturn}


Definition at line 307 of file bsp\+\_\+clocks.\+c.


\begin{DoxyCode}
308 \{
309     \hyperlink{stdint_8h_a324c5d28c0d82f502a234ab99efac87a}{uint32\_t} sysclk;
310     \hyperlink{stdint_8h_a324c5d28c0d82f502a234ab99efac87a}{uint32\_t} factor;
311 
312     \textcolor{comment}{/* Get Source clock */}
313     \textcolor{keywordflow}{if}((*\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} & \hyperlink{bsp__clocks_8h_a451045d952eb1caaa0090c9e8dc75082}{RCC\_CFGR\_SWS\_MASK}) == 
      \hyperlink{bsp__clocks_8h_a2c67e2279804a83ef24438267d9d4a6c}{RCC\_CFGR\_SWS\_PLL})
314     \{
315         sysclk = \hyperlink{bsp__clocks_8c_ac154ab5d2a56dd8e09e0545e9775112e}{bsp\_clock\_get\_pll\_freq}();
316     \}
317     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}((*\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} & RCC\_CFGR\_SWS\_MASK) == 
      \hyperlink{bsp__clocks_8h_a6764639cf221e1ebc0b5448dcaed590a}{RCC\_CFGR\_SWS\_HSI})
318     \{
319         sysclk = \hyperlink{bsp__clocks_8h_ae89e6b2d1e86b7fb4831cb013ece2c52}{RCC\_HSI\_BASE\_FREQ};
320     \}
321     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}((*\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} & RCC\_CFGR\_SWS\_MASK) == 
      \hyperlink{bsp__clocks_8h_ae09a0202f441c1a43e69c62331d50a08}{RCC\_CFGR\_SWS\_HSE})
322     \{
323         sysclk = \hyperlink{bsp__clocks_8h_a19d723f47200a1da259e9c147f2de258}{RCC\_HSE\_BASE\_FREQ};
324     \}
325     \textcolor{keywordflow}{else} 
326     \{
327         \textcolor{comment}{/* We were  not able to detect the input clock */}
328         \textcolor{keywordflow}{return} 0;
329     \}
330 
331     \textcolor{comment}{/* Divide by AHB prescaler */}
332     \textcolor{keywordflow}{if}((*\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} & \hyperlink{bsp__clocks_8h_a1351ccf5f6a5d9a6b91c4f533688d8fb}{RCC\_CFGR\_HPRE\_EN}) != 0)
333     \{
334         factor = (*\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} & \hyperlink{bsp__clocks_8h_a2ff38fa14905e578752b706e5c29b146}{RCC\_CFGR\_HPRE\_VAL\_MASK}) >> 
335                   \hyperlink{bsp__clocks_8h_adca5b474c16bb5c9b4bbedfabeba8e25}{RCC\_CFGR\_HRPE\_OFFSET};
336         sysclk /= (\hyperlink{stdint_8h_a324c5d28c0d82f502a234ab99efac87a}{uint32\_t})\hyperlink{bsp__clocks_8c_abed7da9c2bfa6c8191c3bf928e64041f}{bsp\_hpre\_factor\_lookup}[factor];
337     \}
338 
339     \textcolor{keywordflow}{if}(clk\_id == \hyperlink{bsp__clocks_8h_ad0e92b49c1a7205e3460ca1e54fa9d70a58357d0569548d6c2ba44f27e0aa6ba6}{BSP\_CLOCK\_ID\_HCLK} || clk\_id == 
      \hyperlink{bsp__clocks_8h_ad0e92b49c1a7205e3460ca1e54fa9d70a265c9dec4478eb66904a2dbc6954e598}{BSP\_CLOCK\_ID\_FCLK})
340     \{
341         \textcolor{keywordflow}{return} sysclk;
342     \}
343     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(clk\_id == \hyperlink{bsp__clocks_8h_ad0e92b49c1a7205e3460ca1e54fa9d70a0493d0bbd7edf1aebadb342c5c38f709}{BSP\_CLOCK\_ID\_PCLK1} || clk\_id == 
      \hyperlink{bsp__clocks_8h_ad0e92b49c1a7205e3460ca1e54fa9d70aad46d3b8852f9a4d711c15164bf1c0d3}{BSP\_CLOCK\_ID\_APB1\_TIMER})
344     \{
345         \textcolor{comment}{/* Get the APB1 prescaler */}
346         \textcolor{keywordflow}{if}((*\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} & \hyperlink{bsp__clocks_8h_a7a4503de78658d3271cb5494adc96e41}{RCC\_CFGR\_PPRE1\_EN}) != 0)
347         \{
348             factor = (*\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} & 
      \hyperlink{bsp__clocks_8h_aebda6f102f65bc354b95232527021aba}{RCC\_CFGR\_PPRE1\_VAL\_MASK}) >> 
349                       \hyperlink{bsp__clocks_8h_a1f605f808c9ab7530142dd8808e83a22}{RCC\_CFGR\_PPRE1\_OFFSET};
350 
351             sysclk /= (\hyperlink{stdint_8h_a324c5d28c0d82f502a234ab99efac87a}{uint32\_t})\hyperlink{bsp__clocks_8c_a1ef2cd1399c95dbe65a524595da1fc5c}{bsp\_ppre\_factor\_lookup}[factor];
352 
353             \textcolor{keywordflow}{if}(clk\_id == \hyperlink{bsp__clocks_8h_ad0e92b49c1a7205e3460ca1e54fa9d70aad46d3b8852f9a4d711c15164bf1c0d3}{BSP\_CLOCK\_ID\_APB1\_TIMER})
354             \{
355                 sysclk *= 2;
356             \}
357         \}
358     \}
359     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(clk\_id == \hyperlink{bsp__clocks_8h_ad0e92b49c1a7205e3460ca1e54fa9d70aad62d8c78d2b4617724a82ec190a33ee}{BSP\_CLOCK\_ID\_PCLK2} || clk\_id == 
      \hyperlink{bsp__clocks_8h_ad0e92b49c1a7205e3460ca1e54fa9d70a30cca3be6a7bad72d2c02e9b58ff4d50}{BSP\_CLOCK\_ID\_APB2\_TIMER})
360     \{
361         \textcolor{comment}{/* Get the APB2 prescaler */}
362         \textcolor{keywordflow}{if}((*\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} & \hyperlink{bsp__clocks_8h_a1a384b58d9f246cb60ed0d0bfa92cbf4}{RCC\_CFGR\_PPRE2\_EN}) != 0)
363         \{
364             factor = (*\hyperlink{bsp__clocks_8h_ac454715dd9c4f8ba957cc53f318c58ac}{RCC\_CFGR\_REGISTER} & 
      \hyperlink{bsp__clocks_8h_adb27fe14c6c6c2cb20f13aaf86f0900a}{RCC\_CFGR\_PPRE2\_VAL\_MASK}) >> 
365                       \hyperlink{bsp__clocks_8h_a906e390883db586903c4b1144a182e47}{RCC\_CFGR\_PPRE2\_OFFSET};
366             sysclk /= \hyperlink{bsp__clocks_8c_a1ef2cd1399c95dbe65a524595da1fc5c}{bsp\_ppre\_factor\_lookup}[factor];
367 
368             \textcolor{keywordflow}{if}(clk\_id == \hyperlink{bsp__clocks_8h_ad0e92b49c1a7205e3460ca1e54fa9d70a30cca3be6a7bad72d2c02e9b58ff4d50}{BSP\_CLOCK\_ID\_APB2\_TIMER})
369             \{
370                 sysclk *= 2;
371             \}
372         \}
373     \}
374     \textcolor{keywordflow}{else} 
375     \{
376         sysclk = 0;
377     \}
378 
379 \textcolor{preprocessor}{#if KERNEL\_LOG\_LEVEL >= INFO\_LOG\_LEVEL}
380     KERNEL\_LOG\_INFO(\textcolor{stringliteral}{"System clock frequency requested"}, 
381                     (\textcolor{keywordtype}{void}*)(\hyperlink{stdint_8h_a324c5d28c0d82f502a234ab99efac87a}{uint32\_t})sysclk, 
382                     \textcolor{keyword}{sizeof}(sysclk), 
383                     \hyperlink{error__types_8h_a4db9ee29f2ff83c71567c12f6bfbf28cabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR});
384 \textcolor{preprocessor}{#endif}
385 
386     \textcolor{keywordflow}{return} sysclk;
387 \}
\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsp__clocks_8c_aeeded4b587684fa3383b3d42ee29af1e_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsp__clocks_8c_aeeded4b587684fa3383b3d42ee29af1e_icgraph}
\end{center}
\end{figure}


\subsection{Variable Documentation}
\mbox{\Hypertarget{bsp__clocks_8c_a7e7b4728df96b76f3a8042b7fb46aa8c}\label{bsp__clocks_8c_a7e7b4728df96b76f3a8042b7fb46aa8c}} 
\index{bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}!bsp\+\_\+clk\+\_\+init@{bsp\+\_\+clk\+\_\+init}}
\index{bsp\+\_\+clk\+\_\+init@{bsp\+\_\+clk\+\_\+init}!bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}}
\subsubsection{\texorpdfstring{bsp\+\_\+clk\+\_\+init}{bsp\_clk\_init}}
{\footnotesize\ttfamily \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} bsp\+\_\+clk\+\_\+init = 0\hspace{0.3cm}{\ttfamily [static]}}



Stores the system clock init state. 



Definition at line 28 of file bsp\+\_\+clocks.\+c.

\mbox{\Hypertarget{bsp__clocks_8c_abed7da9c2bfa6c8191c3bf928e64041f}\label{bsp__clocks_8c_abed7da9c2bfa6c8191c3bf928e64041f}} 
\index{bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}!bsp\+\_\+hpre\+\_\+factor\+\_\+lookup@{bsp\+\_\+hpre\+\_\+factor\+\_\+lookup}}
\index{bsp\+\_\+hpre\+\_\+factor\+\_\+lookup@{bsp\+\_\+hpre\+\_\+factor\+\_\+lookup}!bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}}
\subsubsection{\texorpdfstring{bsp\+\_\+hpre\+\_\+factor\+\_\+lookup}{bsp\_hpre\_factor\_lookup}}
{\footnotesize\ttfamily const \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t} bsp\+\_\+hpre\+\_\+factor\+\_\+lookup\mbox{[}8\mbox{]} = \{2, 4, 8, 16, 64, 128, 256, 512\}\hspace{0.3cm}{\ttfamily [static]}}



H\+R\+PE A\+HB prescaler factors lookup table. 



Definition at line 31 of file bsp\+\_\+clocks.\+c.

\mbox{\Hypertarget{bsp__clocks_8c_a1ef2cd1399c95dbe65a524595da1fc5c}\label{bsp__clocks_8c_a1ef2cd1399c95dbe65a524595da1fc5c}} 
\index{bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}!bsp\+\_\+ppre\+\_\+factor\+\_\+lookup@{bsp\+\_\+ppre\+\_\+factor\+\_\+lookup}}
\index{bsp\+\_\+ppre\+\_\+factor\+\_\+lookup@{bsp\+\_\+ppre\+\_\+factor\+\_\+lookup}!bsp\+\_\+clocks.\+c@{bsp\+\_\+clocks.\+c}}
\subsubsection{\texorpdfstring{bsp\+\_\+ppre\+\_\+factor\+\_\+lookup}{bsp\_ppre\_factor\_lookup}}
{\footnotesize\ttfamily const \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t} bsp\+\_\+ppre\+\_\+factor\+\_\+lookup\mbox{[}4\mbox{]} = \{2, 4, 8, 16\}\hspace{0.3cm}{\ttfamily [static]}}



P\+P\+RE prescaler factors lookup table. 



Definition at line 34 of file bsp\+\_\+clocks.\+c.

